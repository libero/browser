sudo: required

language: minimal

services: docker

env: 
    - IMAGE_TAG=$TRAVIS_COMMIT 

install:
    - docker-compose -f docker-compose.yaml build

before_script:
    - docker-compose -f docker-compose.yaml up -d web

script:
    - nc -z localhost 8080
    - docker-compose -f docker-compose.yaml run ci vendor/bin/phpunit
    - docker-compose -f docker-compose.yaml run ci vendor/bin/phpcs

after_script:
    - docker-compose -f docker-compose.yaml down
    # should be executed only if $TRAVIS_BRANCH = master
    - docker login --username $DOCKER_USERNAME --password $DOCKER_PASSWORD
    # tag temporarily as liberoadmin
    - docker tag libero/browser:$IMAGE_TAG liberoadmin/browser:$IMAGE_TAG
    - docker push liberoadmin/browser:$IMAGE_TAG
